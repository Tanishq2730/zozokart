"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[74],{1827:(e,a,s)=>{s.d(a,{Y9:()=>t,Z1:()=>o,vN:()=>n,xu:()=>l});var r=s(1713),d=s(9638);const t=async()=>{try{return(await(0,d.A)(`${r.i3.baseURL}/web/user-address`,"GET")).data}catch(a){var e;return null===(e=a.response)||void 0===e?void 0:e.data}},n=async e=>{console.log(e);try{return(await(0,d.A)(`${r.i3.baseURL}/web/user-address`,"POST",e)).data}catch(s){var a;return null===(a=s.response)||void 0===a?void 0:a.data}},l=async(e,a)=>{try{return(await(0,d.A)(`${r.i3.baseURL}/web/user-address/${e}`,"PATCH",a)).data}catch(t){var s;return null===(s=t.response)||void 0===s?void 0:s.data}},o=async e=>{try{return(await(0,d.A)(`${r.i3.baseURL}/web/user-address/${e}`,"DELETE")).data}catch(s){var a;return null===(a=s.response)||void 0===a?void 0:a.data}}},3074:(e,a,s)=>{s.r(a),s.d(a,{default:()=>E});var r=s(5043),d=s(6165),t=s(8024),n=(s(6356),s(160)),l=(s(5506),s(223)),o=(s(3709),s(3003)),c=s(3216),i=s(5475),m=s(1713),u=s(9638);const h=async e=>{try{return(await(0,u.A)(`${m.i3.baseURL}/web/place-order`,"POST",e)).data}catch(s){var a;return null===(a=s.response)||void 0===a?void 0:a.data}};var p=s(1827),x=s(3821),y=s(3),f=s(591),N=s(782),j=s(6221),g=s(2327),v=s(2345),b=s(7550),A=s(7493),w=s(2679),k=s(6259);var P=s(1915),_=s(579);const C=()=>{var e;const[a,s]=(0,r.useState)("paynow"),[d,t]=(0,r.useState)([]),[n,l]=(0,r.useState)(null),[C,F]=(0,r.useState)(!1),[S,T]=(0,r.useState)(null),[O,z]=(0,r.useState)(null),[E,$]=(0,r.useState)({fullName:"",phoneNumber:"",alternatePhoneNumber:"",pinCode:"",state:"",city:"",houseNumber:"",area:"",nearByFamous:"",default:!1,addressType:"Home"}),I=(0,o.wA)(),D=(0,c.Zp)(),H=(0,o.d4)((e=>null===e||void 0===e?void 0:e.cart.cart)),R=(0,o.d4)((e=>{var a;return null===(a=e.auth)||void 0===a?void 0:a.isAuthenticated})),q=(0,o.d4)((e=>{var a;return null===(a=e.auth)||void 0===a?void 0:a.user})),[M,B]=(0,r.useState)(!1);if((0,r.useEffect)((()=>{R||D("/sign-in")}),[R,D]),(0,r.useEffect)((()=>{(async()=>{if(R&&null!==q&&void 0!==q&&q._id)try{const e=await(0,p.Y9)();if(null!==e&&void 0!==e&&e.success){t(e.data);const a=e.data.find((e=>e.defaultAddress));a?l(a._id):e.data.length>0&&l(e.data[0]._id)}else(0,x.P)("error",(null===e||void 0===e?void 0:e.message)||"Failed to fetch addresses.")}catch(e){(0,x.P)("error","Error fetching addresses.")}})()}),[R,null===q||void 0===q?void 0:q._id]),null===H||void 0===H||!H.items)return(0,_.jsx)("p",{className:"text-center py-40",children:"Your cart is empty."});const L=e=>{s(e.target.id)},U=()=>{F(!1),T(null),z(null),$({fullName:"",phoneNumber:"",alternatePhoneNumber:"",pinCode:"",state:"",city:"",houseNumber:"",area:"",nearByFamous:"",defaultAddress:!1,addressType:"Home"})},Y=e=>{const{name:a,value:s,type:r,checked:d}=e.target;$((e=>({...e,[a]:"checkbox"===r?d:s})))};return(0,_.jsx)("section",{className:"checkout py-20",children:(0,_.jsxs)("div",{className:"container",children:[(0,_.jsxs)(y.A,{size:"lg",isOpen:C,toggle:U,className:"address-modal",children:[(0,_.jsx)(f.A,{toggle:U,children:"add"===S?"Add New Delivery Address":"Edit Delivery Address"}),(0,_.jsx)(N.A,{children:(0,_.jsx)(j.A,{children:(0,_.jsxs)(g.A,{className:"gy-3",children:[(0,_.jsx)(v.A,{sm:6,children:(0,_.jsxs)(b.A,{children:[(0,_.jsx)(A.A,{for:"fullName",children:"Full Name"}),(0,_.jsx)(w.A,{type:"text",className:"common-input border-gray-100",placeholder:"Full Name",name:"fullName",value:E.fullName,onChange:Y,required:!0})]})}),(0,_.jsx)(v.A,{sm:6,children:(0,_.jsxs)(b.A,{children:[(0,_.jsx)(A.A,{for:"phoneNumber",children:"Phone Number"}),(0,_.jsx)(w.A,{type:"text",className:"common-input border-gray-100",placeholder:"Phone Number",name:"phoneNumber",value:E.phoneNumber,onChange:Y,required:!0})]})}),(0,_.jsx)(v.A,{xs:12,children:(0,_.jsxs)(b.A,{children:[(0,_.jsx)(A.A,{for:"alternatePhoneNumber",children:"Alternate Phone Number (Optional)"}),(0,_.jsx)(w.A,{type:"text",className:"common-input border-gray-100",placeholder:"Alternate Phone Number (Optional)",name:"alternatePhoneNumber",value:E.alternatePhoneNumber,onChange:Y})]})}),(0,_.jsx)(v.A,{md:6,xs:12,children:(0,_.jsxs)(b.A,{children:[(0,_.jsx)(A.A,{for:"pinCode",children:"Pin Code"}),(0,_.jsx)(w.A,{type:"text",className:"common-input border-gray-100",placeholder:"Pin Code",name:"pinCode",value:E.pinCode,onChange:Y,required:!0})]})}),(0,_.jsx)(v.A,{md:6,xs:12,children:(0,_.jsxs)(b.A,{children:[(0,_.jsx)(A.A,{for:"state",children:"State"}),(0,_.jsx)(w.A,{type:"text",className:"common-input border-gray-100",placeholder:"State",name:"state",value:E.state,onChange:Y,required:!0})]})}),(0,_.jsx)(v.A,{md:6,xs:12,children:(0,_.jsxs)(b.A,{children:[(0,_.jsx)(A.A,{for:"city",children:"City"}),(0,_.jsx)(w.A,{type:"text",className:"common-input border-gray-100",placeholder:"City",name:"city",value:E.city,onChange:Y,required:!0})]})}),(0,_.jsx)(v.A,{md:6,xs:12,children:(0,_.jsxs)(b.A,{children:[(0,_.jsx)(A.A,{for:"houseNumber",children:"House Number (Optional)"}),(0,_.jsx)(w.A,{type:"text",className:"common-input border-gray-100",placeholder:"House Number (Optional)",name:"houseNumber",value:E.houseNumber,onChange:Y})]})}),(0,_.jsx)(v.A,{xs:12,children:(0,_.jsxs)(b.A,{children:[(0,_.jsx)(A.A,{for:"area",children:"Area (Optional)"}),(0,_.jsx)(w.A,{type:"text",className:"common-input border-gray-100",placeholder:"Area (Optional)",name:"area",value:E.area,onChange:Y})]})}),(0,_.jsx)(v.A,{xs:12,children:(0,_.jsxs)(b.A,{children:[(0,_.jsx)(A.A,{for:"nearByFamous",children:"Nearby Famous Place (Optional)"}),(0,_.jsx)(w.A,{type:"text",className:"common-input border-gray-100",placeholder:"Nearby Famous Place (Optional)",name:"nearByFamous",value:E.nearByFamous,onChange:Y})]})}),(0,_.jsx)(v.A,{xs:12,children:(0,_.jsxs)(b.A,{className:"form-check common-check",children:[(0,_.jsx)(w.A,{type:"checkbox",className:"form-check-input",id:"isDefaultModal",name:"defaultAddress",checked:E.defaultAddress,onChange:Y}),(0,_.jsx)(A.A,{className:"form-check-label fw-normal text-neutral-600",htmlFor:"isDefaultModal",children:"Set as default address"})]})}),(0,_.jsx)(v.A,{xs:12,children:(0,_.jsxs)(b.A,{className:"form-check common-check",children:[(0,_.jsx)(w.A,{type:"radio",className:"form-check-input",id:"addressTypeHomeModal",name:"addressType",value:"Home",checked:"Home"===E.addressType,onChange:Y}),(0,_.jsx)(A.A,{className:"form-check-label fw-normal text-neutral-600 me-3",htmlFor:"addressTypeHomeModal",children:"Home"}),(0,_.jsx)(w.A,{type:"radio",className:"form-check-input",id:"addressTypeWorkModal",name:"addressType",value:"Work",checked:"Work"===E.addressType,onChange:Y}),(0,_.jsx)(A.A,{className:"form-check-label fw-normal text-neutral-600",htmlFor:"addressTypeWorkModal",children:"Work"})]})}),(0,_.jsxs)(v.A,{xs:12,className:"mt-3",children:[(0,_.jsx)(k.A,{color:"primary",className:"rounded-pill me-2",onClick:async()=>{if(null!==q&&void 0!==q&&q._id)try{let s;var e;if("add"===S)if(s=await(0,p.vN)(E),s.success)(0,x.P)("success","New address added successfully."),t([...d,s.data]),s.data.defaultAddress?(l(s.data._id),t((e=>e.map((e=>e._id===s.data._id?{...e,defaultAddress:!0}:{...e,default:!1}))))):n||0!==d.length||l(s.data._id),U();else(0,x.P)("error",(null===(e=s)||void 0===e?void 0:e.message)||"Failed to add new address.");else if("edit"===S&&null!==O&&void 0!==O&&O._id){var a;if(s=await(0,p.xu)(O._id,E),s.success)(0,x.P)("success","Address updated successfully."),t((e=>e.map((e=>e._id===O._id?s.data:e)))),s.data.defaultAddress&&(l(s.data._id),t((e=>e.map((e=>e._id===s.data._id?{...e,defaultAddress:!0}:{...e,defaultAddress:!1}))))),U();else(0,x.P)("error",(null===(a=s)||void 0===a?void 0:a.message)||"Failed to update address.")}}catch(s){(0,x.P)("error",`Error ${"add"===S?"adding":"updating"} address.`)}else(0,x.P)("error","User not authenticated.")},children:"add"===S?"Add Address":"Save Changes"}),(0,_.jsx)(k.A,{color:"secondary",className:"rounded-pill",onClick:U,children:"Cancel"})]})]})})})]}),(0,_.jsxs)("div",{className:"row",children:[(0,_.jsx)("div",{className:"col-xl-7 col-lg-7",children:(0,_.jsxs)("div",{className:"mb-40",style:{backgroundColor:"#fff",padding:"20px"},children:[(0,_.jsx)("h6",{className:"text-lg mb-24",children:"Select Delivery Address"}),d.length>0?d.map((e=>(0,_.jsxs)("div",{className:"border border-gray-200 rounded-8 p-24 mb-16 "+(n===e._id?"border-main-600":""),children:[(0,_.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-12",children:[(0,_.jsxs)("div",{className:"form-check common-check common-radio",children:[(0,_.jsx)(w.A,{className:"form-check-input",type:"radio",name:"deliveryAddress",id:`address-${e._id}`,value:e._id,checked:n===e._id,onChange:()=>{return a=e._id,void l(a);var a}}),(0,_.jsxs)(A.A,{className:"form-check-label fw-semibold text-gray-900",htmlFor:`address-${e._id}`,children:[e.fullName," (",e.addressType,")"," ",e.defaultAddress&&(0,_.jsx)("span",{className:"text-sm text-main-600",children:"(Default)"})]})]}),(0,_.jsxs)("div",{children:[(0,_.jsx)(k.A,{color:"primary",size:"sm",className:"me-1",onClick:()=>(e=>{T("edit"),$({...e}),z(e),F(!0)})(e),children:"Edit"}),(0,_.jsx)(k.A,{color:"danger",size:"sm",className:"text-danger",onClick:()=>(async e=>{if(null!==q&&void 0!==q&&q._id&&e){if(window.confirm("Are you sure you want to delete this address?"))try{const a=await(0,p.Z1)(e);null!==a&&void 0!==a&&a.success?((0,x.P)("success","Address deleted successfully."),t((a=>a.filter((a=>a._id!==e)))),n===e&&l(d.length>1?d[0]._id:null)):(0,x.P)("error",(null===a||void 0===a?void 0:a.message)||"Failed to delete address.")}catch(a){(0,x.P)("error","Error deleting address.")}}else(0,x.P)("error","Invalid request to delete address.")})(e._id),children:"Delete"})]})]}),(0,_.jsxs)("p",{className:"text-gray-700 mb-8",children:[e.houseNumber&&`${e.houseNumber}, `,e.area,","," ",e.nearByFamous&&`Near ${e.nearByFamous}, `,e.city,", ",e.state," - ",e.pinCode]}),(0,_.jsxs)("p",{className:"text-gray-700",children:["Phone: ",e.phoneNumber,e.alternatePhoneNumber&&`, Alt: ${e.alternatePhoneNumber}`]})]},e._id))):(0,_.jsx)("p",{className:"text-gray-500",children:"No delivery addresses found. Please add a new one."}),(0,_.jsx)(k.A,{color:"secondary",className:"rounded-pill mt-16",onClick:()=>{T("add"),$({fullName:"",phoneNumber:"",alternatePhoneNumber:"",pinCode:"",state:"",city:"",houseNumber:"",area:"",nearByFamous:"",defaultAddress:!1,addressType:"Home"}),z(null),F(!0)},children:"Add New Address"})]})}),(0,_.jsx)("div",{className:"col-xl-5 col-lg-5",children:(0,_.jsxs)("div",{className:"checkout-sidebar",style:{backgroundColor:"#fff",padding:"20px"},children:[(0,_.jsx)("div",{className:"bg-color-three rounded-8 p-24 text-center",children:(0,_.jsx)("span",{className:"text-gray-900 text-xl fw-semibold",children:"Your Orders"})}),(0,_.jsxs)("div",{className:"border border-gray-100 rounded-8 px-24 py-40 mt-24",children:[(0,_.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-32 pb-32 border-bottom border-gray-100 gap-8",children:[(0,_.jsx)("span",{className:"text-gray-900 fw-medium text-xl font-heading-two",children:"Product"}),(0,_.jsx)("span",{className:"text-gray-900 fw-medium text-xl font-heading-two",children:"Subtotal"})]}),H.items.length>0?null===(e=H.items)||void 0===e?void 0:e.map((e=>(0,_.jsxs)("div",{className:"d-flex justify-content-between gap-24 mb-32",children:[(0,_.jsxs)("div",{className:"d-flex align-items-center gap-12",children:[(0,_.jsx)("span",{className:"text-gray-900 fw-normal text-md font-heading-two w-144",children:e.productId.name}),(0,_.jsx)("span",{className:"text-gray-900 fw-normal text-md font-heading-two",children:(0,_.jsx)("i",{className:"ph-bold ph-x"})}),(0,_.jsx)("span",{className:"text-gray-900 fw-semibold text-md font-heading-two",children:e.quantity})]}),(0,_.jsxs)("span",{className:"text-gray-900 fw-bold text-md font-heading-two",children:["\u20b9",e.quantity*e.variationId.salePrice]})]},e.productId._id+e.variationId._id))):(0,_.jsxs)("div",{className:"empty-cart p-10 text-center",style:{flex:1},children:[(0,_.jsx)("p",{className:"text-black",children:"No products in the cart."}),(0,_.jsx)(i.N_,{to:"/shop",className:"btn btn-main d-inline-flex align-items-center rounded-pill gap-8 mt-24",children:"Return To Shop"})]}),(0,_.jsxs)("div",{className:"d-flex justify-content-between gap-24 py-20  border-top",children:[(0,_.jsx)("div",{className:"d-flex align-items-center gap-12",children:(0,_.jsx)("span",{className:"text-gray-900 fw-normal text-md font-heading-two w-144",children:"Subtotal"})}),(0,_.jsxs)("span",{className:"text-gray-900 fw-bold text-md font-heading-two",children:["\u20b9",H.subTotal]})]}),(0,_.jsxs)("div",{className:"d-flex justify-content-between gap-24 py-20 border-top",children:[(0,_.jsx)("div",{className:"d-flex align-items-center gap-12",children:(0,_.jsx)("span",{className:"text-gray-900 fw-normal text-md font-heading-two w-144",children:"Shipping"})}),(0,_.jsx)("span",{className:"text-gray-900 fw-bold text-md font-heading-two",children:"Free"})]}),(0,_.jsxs)("div",{className:"d-flex justify-content-between gap-24 py-20  border-top",children:[(0,_.jsx)("div",{className:"d-flex align-items-center gap-12",children:(0,_.jsx)("span",{className:"text-gray-900 fw-normal text-md font-heading-two w-144",children:"Discount"})}),(0,_.jsxs)("span",{className:"text-gray-900 fw-bold text-md font-heading-two",children:["\u20b9",H.discount]})]}),(0,_.jsxs)("div",{className:"d-flex justify-content-between gap-24 py-20  border-top",children:[(0,_.jsx)("div",{className:"d-flex align-items-center gap-12",children:(0,_.jsx)("span",{className:"text-gray-900 fw-normal text-md font-heading-two w-144",children:"Total"})}),(0,_.jsxs)("span",{className:"text-gray-900 fw-bold text-md font-heading-two",children:["\u20b9",H.total]})]})]}),(0,_.jsxs)("div",{className:"mt-32",children:[(0,_.jsxs)("div",{className:"payment-item",children:[(0,_.jsxs)("div",{className:"form-check common-check common-radio py-16 mb-0",children:[(0,_.jsx)(w.A,{className:"form-check-input",type:"radio",name:"payment",id:"paynow",checked:"paynow"===a,onChange:L}),(0,_.jsx)(A.A,{className:"form-check-label fw-semibold text-neutral-600",htmlFor:"paynow",children:"Pay Now"})]}),"paynow"===a&&(0,_.jsx)("div",{className:"payment-item__content px-16 py-24 rounded-8 bg-main-50 position-relative d-block",children:(0,_.jsx)("p",{className:"text-gray-800",children:"Make your payment directly into our bank account. Please use your Order ID as the payment reference. Your order will not be shipped until the funds have cleared in our account."})})]}),(0,_.jsxs)("div",{className:"payment-item",children:[(0,_.jsxs)("div",{className:"form-check common-check common-radio py-16 mb-0",children:[(0,_.jsx)(w.A,{className:"form-check-input",type:"radio",name:"payment",id:"cod",checked:"cod"===a,onChange:L}),(0,_.jsx)(A.A,{className:"form-check-label fw-semibold text-neutral-600",htmlFor:"cod",children:"Cash on delivery"})]}),"cod"===a&&(0,_.jsx)("div",{className:"payment-item__content px-16 py-24 rounded-8 bg-main-50 position-relative d-block",children:(0,_.jsx)("p",{className:"text-gray-800",children:"Pay with cash upon delivery."})})]})]}),(0,_.jsx)("div",{className:"mt-32 pt-32 border-top border-gray-100",children:(0,_.jsxs)("p",{className:"text-gray-500",children:["Your personal data will be used to process your order, support your experience throughout this website, and for other purposes described in our"," ",(0,_.jsxs)(i.N_,{to:"#",className:"text-main-600 text-decoration-underline",children:[" ","privacy policy"]})," ","."]})}),(0,_.jsx)(k.A,{color:"primary",className:"mt-40 py-18 w-100 rounded-8 mt-56",onClick:async()=>{if("paynow"===a){if(!n)return void(0,x.P)("warning","Please select a delivery address.");if(!await new Promise((e=>{if(document.querySelector('script[src="https://checkout.razorpay.com/v1/checkout.js"]'))return void e(!0);const a=document.createElement("script");a.src="https://checkout.razorpay.com/v1/checkout.js",a.onload=()=>e(!0),a.onerror=()=>e(!1),document.body.appendChild(a)})))return void(0,x.P)("error","Failed to load Razorpay SDK.");I({type:"loader",loader:!0});try{var e;const a=await(async e=>{try{return(await(0,u.A)(`${m.i3.baseURL}/web/create-razorpay-order`,"POST",e)).data}catch(s){var a;return null===(a=s.response)||void 0===a?void 0:a.data}})({amount:100*H.total});if(!a.success){const e=a.message;return void(0,x.P)("error",e||"Failed to create payment order.")}I({type:"loader",loader:!1});const s=a.data,r={key:"rzp_test_sbbCHuQzenmT45",amount:s.amount,currency:"INR",order_id:s.id,name:"ZozoKart",description:"Payment for your order",image:"assets/images/logo/logo.png",handler:async e=>{if(null!==e&&void 0!==e&&e.razorpay_payment_id){I({type:"loader",loader:!0});const a=await h({addressId:n,paymentId:e.razorpay_payment_id,orderId:s.id,paymentSignature:e.razorpay_signature,paymentMethod:"Razorpay"});null!==a&&void 0!==a&&a.success?((0,x.P)("success",a.message),I({type:P.nP}),D("/order-success")):(0,x.P)("error",(null===a||void 0===a?void 0:a.message)||"Failed to place order after successful payment."),I({type:"loader",loader:!1})}else(0,x.P)("error","Payment failed or was cancelled."),I({type:"loader",loader:!1})},prefill:{name:(null===q||void 0===q?void 0:q.name)||"",email:(null===q||void 0===q?void 0:q.email)||"",contact:(null===(e=d.find((e=>e._id===n)))||void 0===e?void 0:e.phoneNumber)||""},theme:{color:"#3399cc"}};new window.Razorpay(r).open()}catch(s){console.error("Error initiating payment:",s),(0,x.P)("error","Failed to initiate payment.")}finally{I({type:"loader",loader:!1})}}else(async()=>{if(n)try{const e=await h({addressId:n,paymentId:"",orderId:"",paymentSignature:"",paymentMethod:"COD"});console.log(e),null!==e&&void 0!==e&&e.success?((0,x.P)("success",e.message),I({type:P.nP}),D("/order-success")):(0,x.P)("error",e.message||"Failed to place order.")}catch(s){(0,x.P)("error","Error placing order.")}else(0,x.P)("error","Please select a delivery address.")})()},disabled:!n,children:"Place Order"})]})})]})]})})};var F=s(1318),S=s.n(F),T=s(9958),O=s(895),z=s(9647);const E=()=>(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(t.A,{color:!0}),(0,_.jsx)(S(),{smooth:!0,color:"#FA6400"}),(0,_.jsx)(d.A,{}),(0,_.jsx)(T.A,{}),(0,_.jsx)(z.A,{}),(0,_.jsx)(n.A,{title:"Checkout"}),(0,_.jsx)(C,{}),(0,_.jsx)(O.A,{}),(0,_.jsx)(l.A,{})]})}}]);
//# sourceMappingURL=74.1d8ad7fd.chunk.js.map